#!/usr/bin/env bash
# Fetch secrets from Bitwarden during initial setup
set -euo pipefail

# Skip if bw not installed
command -v bw &>/dev/null || { echo "==> Skipping secrets (bw not installed)"; exit 0; }

# Call the update script's secrets function from source state.
update_script="{{ .chezmoi.sourceDir }}/dot_local/bin/executable_update"
if [[ ! -f "$update_script" ]]; then
    echo "==> Skipping secrets (update script not found: $update_script)"
    exit 0
fi
if ! command -v python3 &>/dev/null; then
    echo "==> Skipping secrets (python3 not available)"
    exit 0
fi

if ! python3 "$update_script" --profile "{{ .profile }}" secrets; then
    echo "==> Secrets fetch skipped (run 'update secrets' later)."
fi
